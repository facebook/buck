<idea-plugin version="2">
  <id>intellij.buck.plugin</id>
  <name>Buck for IDEA</name>
  <version>3.5-SNAPSHOT</version>
  <category>Build</category>
  <vendor email="fb-plugins@fb.com" url="www.facebook.com">Facebook, Inc.</vendor>

  <description><![CDATA[
      An IntelliJ plugin for Buck build system.<br>
      <h3>Features:</h3>
      <ul>
        <li>Syntax highlighting for BUCK file</li>
        <li>Keywords auto completion</li>
        <li>Go to buck file with one click</li>
        <li>Go to to paths of dependencies with one click</li>
        <li>Buck file formatter</li>
        <li>Buck line commenter</li>
        <li>Buck dependencies sorter</li>
      </ul>
    ]]></description>

  <change-notes><![CDATA[
<h3>3.5</h3>
<ul>
  <li>Moved "Go to Buck file" action to Navigate menu and "Go To" popup menu.</li>
  <li>Show warning about missing Buck server as a balloon.</li>
  <li>Introduce project-level settings, stored in <code>.idea/ideabuck.xml</code></li>
</ul>

<h3>3.4</h3>
<ul>
  <li>Enable Layout Preview in Android projects generated by <code>buck project</code>.</li>
  <li>Support Skylark <code>glob</code> API (<code>exclude</code> attribute).</li>
  <li>Auto-complete <code>load</code> functions.</li>
  <li>Add limited support for detecting missing extension files referenced in <code>load</code>
  function. Currently only targets from the same cell are checked.</li>
  <li>Add limited <code>load</code> function target navigation. Currently only targets from the
  same cell are supported.</li>
</ul>

<h3>3.3</h3>
<ul>
  <li>"Optimize Imports" now removes duplicate dependencies.</li>
  <li>The paste code will not transform text if within a non-empty string.</li>
</ul>

<h3>3.2</h3>
<ul>
  <li>Fix paste bugs; add unit tests so paste doesn't break again.</li>
  <li>Move <tt>adb</tt>/<tt>buck</tt> configuration checks to point of use, so you no longer get
   Fatal Errors on opening IJ if you don't have <tt>adb</tt> installed.</li>
</ul>

<h3>3.1</h3>
<ul>
  <li>Detect new package creation, and mark it as a source folder.</li>
  <li>Remove the default folding of large arrays.</li>
</ul>

<h3>3.0</h3>
<ul>
  <li>Make plugin compatible with IntelliJ 2017.1.</li>
</ul>

<h3>2.9</h3>
<ul>
  <li>Add an ability to run tests from editor.</li>
  <li>Find adb based on ANDROID_SDK environment variable.</li>
  <li>Fold BUCK files.</li>
</ul>

<h3>2.8</h3>
<ul>
  <li>Detect resource creation in a Project View's <tt>/res</tt> directory,
    and moves the new file to an Android resource module.</li>
</ul>

<h3>2.7.8</h3>
<ul>
  <li>Fixed issues with Buck files showing syntax errors when using
    the glob function.</li>
</ul>

<h3>2.7.7</h3>
<ul>
  <li>Fix a bug with buck command never finishes. This solves the problem
    with not showing targets in "Choose Buck Target" pop-up.</li>
  <li>Use buck config to determine Buck file name (default is BUCK).</li>
</ul>

<h3>2.7.6</h3>
<ul>
  <li>Change pasting formatting to have double-quotes and four-space
    indents.</li>
</ul>

<h3>2.7.5</h3>
<ul>
  <li>Fix go-to-definition to recognize both single- and double-quoted
    strings.</li>
  <li>Fix how the icon gets initialized for the buck tool window.</li>
</ul>

<h3>2.7.4</h3>
<ul>
  <li>Added support for pasting multiple targets in a Buck file.</li>
  <li>Fixed issues with whitespace when pasting target(s) in a
    Buck file.</li>
</ul>

<h3>2.7.3</h3>
<ul>
  <li>Removed restriction on IDEA version.</li>
  <li>Added test run configuration.</li>
</ul>

<h3>2.7.2</h3>
<ul>
  <li>Fixed a bug with NullPointerException in BuckEventsQueue.</li>
  <li>Fixed multiple edge cases with autodeps logic.</li>
</ul>

<h3>2.7.1</h3>
<ul>
  <li>Updated upper-bound of plugin to 2016.2.</li>
</ul>

<h3>2.7.0</h3>
<ul>
  <li>Sending events for Buck plugin IntelliJ actions.</li>
  <li>Added adb select path to Tools.</li>
</ul>

<h3>2.6</h3>
<ul>
  <li>Improved server connect/disconnect.</li>
  <li>Moved actions from the UI thread.</li>
  <li>Fixed some compatibility issues.</li>
</ul>

<h3>2.5</h3>
<ul>
  <li>Updated buck icons.</li>
  <li>Made all existing paths in a Buck file clickable.</li>
  <li>Improved grammar.</li>
  <li>Show popup on how to enable the toolbar.</li>
  <li>Disable choose target if indexing not over.</li>
</ul>

<h3>2.4</h3>
<ul>
  <li>Added the plugin to the toolbar.</li>
  <li>Show successful/failed notification on action finished.</li>
  <li>Automatically find buck executable.</li>
  <li>Added install debugging.</li>
  <li>Minor bug fixes.</li>
</ul>

<h3>2.3</h3>
<ul>
  <li>Updated with the new buck API.</li>
  <li>Fixed old commands to work with Buck.</li>
</ul>

<h3>2.2</h3>
<ul>
  <li>Fetch build status via websocket.</li>
  <li>Publish build status notifications.</li>
</ul>

<h3>1.1</h3>
<ul>
  <li>Formatter for buck file.</li>
  <li>Buck dependencies sorter.</li>
  <li>Annotator for wrong buck dependency target.</li>
  <li>Line commenter.</li>
</ul>
    ]]>
  </change-notes>

  <!-- please see https://confluence.jetbrains.com/display/IDEADEV/Build+Number+Ranges for description -->
  <idea-version since-build="172.1294"/>

  <depends>com.intellij.modules.platform</depends>
  <depends>com.intellij.modules.lang</depends>

  <depends optional="true">org.jetbrains.android</depends>

  <extensions defaultExtensionNs="com.intellij">
    <fileTypeFactory implementation="com.facebook.buck.intellij.ideabuck.file.BuckFileTypeFactory"/>
    <lang.parserDefinition
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.lang.BuckParserDefinition"/>
    <lang.syntaxHighlighterFactory
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.highlight.BuckSyntaxHighlighterFactory"/>
    <lang.formatter
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.format.BuckFormattingModelBuilder"/>
    <lang.importOptimizer
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.format.BuckImportOptimizer"/>
    <lang.foldingBuilder
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.folding.BuckFoldingBuilder"/>
    <completion.contributor
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.completion.BuckCompletionContributor"/>
    <codeStyleSettingsProvider
      implementation="com.facebook.buck.intellij.ideabuck.config.BuckCodeStyleSettingsProvider"/>
    <langCodeStyleSettingsProvider
      implementation="com.facebook.buck.intellij.ideabuck.format.BuckLanguageCodeStyleSettingsProvider"/>
    <gotoDeclarationHandler
      implementation="com.facebook.buck.intellij.ideabuck.navigation.BuckGotoProvider"
      order="FIRST"/>
    <annotator language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.annotator.BuckAnnotator"/>
    <colorSettingsPage
      implementation="com.facebook.buck.intellij.ideabuck.config.BuckColorSettingsPage"/>
    <lang.commenter language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.commenter.BuckCommenter"/>
    <lang.braceMatcher
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.format.BuckBraceMatcher"/>
    <quoteHandler
      fileType="Buck"
      className="com.facebook.buck.intellij.ideabuck.format.BuckQuoteHandler"/>
    <copyPastePreProcessor
      implementation="com.facebook.buck.intellij.ideabuck.format.BuckCopyPasteProcessor"/>
    <toolWindow
      id="Buck"
      anchor="bottom"
      icon="/icons/buck_tool_window_icon.png"
      factoryClass="com.facebook.buck.intellij.ideabuck.ui.BuckToolWindowFactory"/>
    <projectConfigurable
      groupId="tools"
      displayName="Buck"
      id="buck.settings"
      instance="com.facebook.buck.intellij.ideabuck.config.BuckSettingsConfigurable"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.build.BuckBuildManager"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.ui.BuckUIManager"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.notification.BuckNotification"/>
    <configurationType
      implementation="com.facebook.buck.intellij.ideabuck.configurations.TestConfigurationType"/>
    <programRunner
      implementation="com.facebook.buck.intellij.ideabuck.configurations.TestProgramRunner"/>
    <runLineMarkerContributor language="JAVA"
      implementationClass="com.facebook.buck.intellij.ideabuck.actions.select.SelectedTestRunLineMarkerContributor"/>
  </extensions>

  <extensions defaultExtensionNs="com.android.project">
    <featureEnableService
      implementation="com.facebook.buck.intellij.ideabuck.proj.BuckFeatureEnableService"/>
  </extensions>

  <actions>
    <group id="buck.Menu">
      <action
        id="buck.GoToBuckFile"
        class="com.facebook.buck.intellij.ideabuck.actions.GoToBuckFile"
        text="Buck file"
        description="Go to Buck file for this source file.">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift P"/>
      </action>
      <add-to-group anchor="first" group-id="EditorPopupMenu.GoTo"/>
      <add-to-group group-id="GoToMenu" anchor="after" relative-to-action="GoToCodeGroup"/>
    </group>

    <group id="buck.ToolbarActions">
      <action
        id="buck.GoToBuckFileToolbarAction"
        class="com.facebook.buck.intellij.ideabuck.actions.GoToBuckFile"
        text="Go to Buck file"
        icon="/icons/actions/GoTo.png"
        description="Go to Buck file for this source file.">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift P"/>
      </action>
      <add-to-group anchor="last" group-id="MainToolBar"/>
    </group>

    <group id="buck.BuildGroup">
      <separator></separator>
      <action class="com.facebook.buck.intellij.ideabuck.actions.ChooseTargetAction"
        id="buck.ChooseTarget">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift J"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckBuildAction" id="buck.Build">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift S"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckTestAction" id="buck.Test">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift Y"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckInstallAction"
        id="buck.Install">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift X"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckInstallDebugAction"
        id="buck.InstallDebug">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift D"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckUninstallAction"
        id="buck.Uninstall">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift M"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckKillAction" id="buck.Kill">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift L"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckProjectGenerationAction"
        id="buck.ProjectGeneration">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift B"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.ScrollToEndAction" id="buck.ScrollToEnd" />
      <action class="com.facebook.buck.intellij.ideabuck.actions.ClearTreeViewPanelAction" id="buck.Clear" />
      <add-to-group anchor="last" group-id="MainToolBar"/>
    </group>
  </actions>

  <project-components>
    <component>
      <implementation-class>com.facebook.buck.intellij.ideabuck.config.BuckModule
      </implementation-class>
      <loadForDefaultProject/>
    </component>
    <component>
      <implementation-class>com.facebook.buck.intellij.ideabuck.config.BuckProjectSettingsProvider
      </implementation-class>
    </component>
  </project-components>
</idea-plugin>

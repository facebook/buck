<!doctype html><html xmlns="http://www.w3.org/1999/xhtml"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns#"><title>Buck: genrule()</title><link type="image/png" rel="shortcut icon" href="/buck/static/favicon.png" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" /><meta http-equiv="content-type" content="text/html;charset=utf-8"><link type="text/css" rel="stylesheet" href="/buck/google-code-prettify/prettify.css" ><link type="text/css" rel="stylesheet" href="/buck/static/buck.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40185670-1', 'github.io'); ga('send', 'pageview');</script><meta property="og:locale" content="en_US"><meta property="og:title" content="genrule()"><meta property="og:site_name" content="Buck: an Android build tool"><meta property="og:image" content="http://facebook.github.io/buck/static/og.png"><meta property="og:type" content="article"><meta property="fb:admins" content="584556688222168"></head><body><div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=584556688222168"; fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script><header class='topbar'><nav class='width'><a href='http://facebook.github.io/buck/'><h1>Buck</h1></a><ul class='menu'><li><a href='/buck/setup/quick_start.html'>Get Started</a><li><a href='https://groups.google.com/forum/#!forum/buck-build'>Group</a><li><a href='/buck/javadoc/'>API</a><li><a href='https://github.com/facebook/buck'>GitHub</a></ul></nav></header><section class='content'><div class='width'><article><h1>genrule()</h1><div class="overview">A <code>genrule()</code> is used to generate a file from a shell command. It must produce a single output file.<h2>Arguments</h2><ul class="arglist"><li class="arg"><code>name</code> (required) The name of the genrule.<li class="arg"><code>srcs</code> (defaults to <code>[]</code>) A list of files to be used in the shell command.<li class="arg"><code>cmd</code> (defaults to <code>None</code>) The shell command to run to generate the output file. It is the fallback of <code>bash</code> and <code>cmd_exe</code>. It will be subject to the following environment variable substitutions:<dl><dt><code>SRCS</code><dt><dd>A space-delimited string expansion of the <code>srcs</code> argument where each element of <code>srcs</code> will be translated into an absolute path.</dd><dt><code>SRCDIR</code><dt><dd>The absolute path to a directory to which sources are copied to prior to running the command.</dd><dt><code>OUT</code></dt><dd>The output file for the <code>genrule()</code>. The file specified by this variable must always be written by this command. If not, the execution of this rule will be considered a failure, halting the build process.</dd></dl>It is also possible to expand references to other rules within the <code>cmd</code>. This expansion takes two supported forms:<dl><dt><code>$(exe /&#x2F;path/to:target)</code></dt><dd>Expands a build rule that results in an executable to the commands necessary to execute that command. For example, a <code>java_binary()</code> may expand to a call to <code>java -jar path/to/target.jar</code>. Files that are executable (perhaps generated by a <code>genrule()</code>) will also be expanded. If the build rule does not generate an executable output an exception will be thrown and the build will break.</dd><dt><code>$(location /&#x2F;path/to:target)</code></dt><dd>Expands to the location of the output of the build rule. This means that you can refer to these without needing to be aware of how Buck is storing data on the disk mid-build.</dd></dl>Note that all build rules expanded in the command must be listed in the <code>deps</code> parameter of the <code>genrule()</code>.<li class="arg"><code>bash</code> (defaults to <code>None</code>) The platform-specific version of parameter <code>cmd</code>. It runs on UNIX in which <code>bash</code> is installed and has a higher priority than <code>cmd</code>. Command specified will be run with <code>/bin/bash -c</code>.<li class="arg"><code>cmd_exe</code> (defaults to <code>None</code>) The platform-specific version of parameter <code>cmd</code>. It runs on Windows and has a higher priority than <code>cmd</code>. Command specified will be run with <code>cmd.exe /c</code>.<li class="arg"><code>out</code> (required) The name of the output file. Must be unique within the build file in which the <code>genrule()</code> is declared.<li class="arg"><code>deps</code> (defaults to <code>[]</code>) A list of rules that must be built before this rule. These may be accessed within the <code>cmd</code> by treating the target as a brace-wrapped variable: <code>$(location /&#x2F;like:this)</code>.<li class="arg"><code>visibility</code> (defaults to <code>[]</code>) List of <a href="/buck/concept/build_target_pattern.html">build target patterns</a> that identify the build rules that can include this rule in its <code>deps</code>.</ul><h2>Examples</h2>This genrule() uses a Python script to derive a new <code>AndroidManifest.xml</code> from an <code>AndroidManifest.xml</code> in the source tree.<pre class="prettyprint lang-py">
genrule(
  name = 'generate_manifest',
  srcs = [
    'AndroidManifest.xml',
  ],
  bash = 'python $(exe //python/android:basic_to_full) ' \
      '$SRCDIR/AndroidManifest.xml > $OUT',
  cmd_exe = 'python.exe $(exe //python/android:basic_to_full) ' \
      '%SRCDIR%\\AndroidManifest.xml > %OUT%',
  out = 'AndroidManifest.xml',
  deps = [
    '//python/android:basic_to_full',
  ]
)
</pre><h2>See Also</h2><a href="/buck/function/genfile.html"><code>genfile()</code></a> function.</div></article><nav><h3>Getting Started</h3><ul><li><a href="/buck/">Overview</a><li><a href="/buck/setup/quick_start.html">Quick Start</a><li><a href="/buck/setup/install.html">Downloading and Installing Buck</a></ul><h3>About</h3><ul><li><a href="/buck/concept/what_makes_buck_so_fast.html">What Makes Buck so Fast?</a><li><a href="/buck/concept/troubleshooting.html">Troubleshooting</a><li><a href="/buck/about/performance_tuning.html">Performance Tuning</a><li><a href="/buck/concept/faq.html">FAQ</a></ul><h3>Concepts</h3><ul><li><a href="/buck/concept/build_rule.html">Build Rule</a><li><a href="/buck/concept/build_target.html">Build Target</a><li><a href="/buck/concept/build_file.html">Build File</a><li><a href="/buck/concept/buckversion.html">.buckversion</a><li><a href="/buck/concept/nobuckcheck.html">.nobuckcheck</a><li><a href="/buck/concept/buckconfig.html">.buckconfig</a><li><a href="/buck/concept/build_target_pattern.html">Build Target Pattern</a><li><a href="/buck/concept/visibility.html">Visibility</a></ul><h3>Build Rules</h3><ul><li><a href="/buck/rule/android_binary.html">android_binary()</a><li><a href="/buck/rule/android_library.html">android_library()</a><li><a href="/buck/rule/android_resource.html">android_resource()</a><li><a href="/buck/rule/apk_genrule.html">apk_genrule()</a><li><a href="/buck/rule/gen_aidl.html">gen_aidl()</a><li><a href="/buck/rule/genrule.html">genrule()</a><li><a href="/buck/rule/java_binary.html">java_binary()</a><li><a href="/buck/rule/java_library.html">java_library()</a><li><a href="/buck/rule/java_test.html">java_test()</a><li><a href="/buck/rule/keystore.html">keystore()</a><li><a href="/buck/rule/ndk_library.html">ndk_library()</a><li><a href="/buck/rule/prebuilt_jar.html">prebuilt_jar()</a><li><a href="/buck/rule/prebuilt_native_library.html">prebuilt_native_library()</a><li><a href="/buck/rule/project_config.html">project_config()</a></ul><h3>Functions</h3><ul><li><a href="/buck/function/genfile.html">genfile()</a><li><a href="/buck/function/glob.html">glob()</a><li><a href="/buck/function/include_defs.html">include_defs()</a></ul><h3>Commands</h3><ul><li><a href="/buck/command/audit.html">buck audit</a><li><a href="/buck/command/build.html">buck build</a><li><a href="/buck/command/clean.html">buck clean</a><li><a href="/buck/command/install.html">buck install</a><li><a href="/buck/command/project.html">buck project</a><li><a href="/buck/command/quickstart.html">buck quickstart</a><li><a href="/buck/command/targets.html">buck targets</a><li><a href="/buck/command/test.html">buck test</a><li><a href="/buck/command/uninstall.html">buck uninstall</a><li><a href="/buck/command/buckd.html">buckd</a></ul><h3>Extending Buck</h3><ul><li><a href="/buck/extending/macros.html">Custom Macros</a><li><a href="/buck/extending/rules.html">Custom Rules</a></ul><h3>Contributing to Buck</h3><ul><li><a href="https://groups.google.com/group/buck-build">Discussion Group</a><li><a href="https://github.com/facebook/buck/issues/new">Report a Bug</a><li><a href="/buck/contributing/development.html">Development Workflow</a><li><a href="/buck/contributing/codestyle.html">Code Style</a><li><a href="/buck/javadoc">API</a><li><a href="https://github.com/facebook/buck">Browse the Source Code</a></ul></ul></nav></div></section><footer><div class='width'>&copy; Copyright Facebook, 2013 -</div></footer><script src="/buck/google-code-prettify/prettify.js"></script><script>prettyPrint()</script></body></html>
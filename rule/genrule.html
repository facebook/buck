<!doctype html><html xmlns="http://www.w3.org/1999/xhtml"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns#"><script>var loc = new String(window.location); if (loc.indexOf('facebook.github.io/buck') != -1) {window.location.replace(loc.replace('facebook.github.io/buck', 'buckbuild.com'));}</script><!-- Facebook Pixel Code --><script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','//connect.facebook.net/en_US/fbevents.js'); fbq('init', '1637165926500152'); fbq('track', 'PageView');</script><noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1637165926500152&ev=PageView&noscript=1" /></noscript><!-- End Facebook Pixel Code --><title>Buck: genrule()</title><link type="image/png" rel="shortcut icon" href="/static/favicon.png" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" /><meta http-equiv="content-type" content="text/html;charset=utf-8"><link type="text/css" rel="stylesheet" href="/google-code-prettify/prettify.css" ><link type="text/css" rel="stylesheet" href="/static/buck.css"><link type="text/css" rel="stylesheet" href="/static/search.css"><link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" /><meta property="og:locale" content="en_US"><meta property="og:title" content="genrule()"><meta property="og:site_name" content="Buck: a build tool"><meta property="og:image" content="http://buckbuild.com/static/og.png"><meta property="og:type" content="article"><meta property="og:description" content="A rule that is used to generate files from a shell command. It must produce a single output file or folder."><meta property="fb:admins" content="584556688222168"><script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-44373548-18', 'auto');
    ga('send', 'pageview');
  </script></head><body><div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=584556688222168"; fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script><header class='topbar'><nav class='width'><a href='http://buckbuild.com/'><h1>Buck</h1></a><ul class='menu'><li class="algolia-search-wrapper"><input id="algolia-doc-search" type="search" placeholder="Search docs..." /></li><li><a href='/setup/getting_started.html'>Docs</a><li><a href='https://groups.google.com/forum/#!forum/buck-build'>Group</a><li><a href='https://github.com/facebook/buck'>GitHub</a></ul></nav></header><section class='content'><div class='width'><article id="content"><h1>genrule()</h1><div class="overview">A <code>genrule()</code> is used to generate files from a shell command. It must produce a single output file or folder.<h2>Arguments</h2><ul class="arglist"><li id="name" class="arg"><h3><code class="argName">name</code> <span class="argDefault">(required)</span> <a class="inline-link" href="#name">#</a></h3><p>The name of the genrule.</p></li><li id="srcs" class="arg"><h3><code class="argName">srcs</code> <span class="argDefault">(defaults to <code>[]</code>)</span> <a class="inline-link" href="#srcs">#</a></h3><p>A list of files to be used in the shell command.</p></li><li id="cmd" class="arg"><h3><code class="argName">cmd</code> <span class="argDefault">(defaults to <code>None</code>)</span> <a class="inline-link" href="#cmd">#</a></h3><p>The shell command to run to generate the output file. It is the fallback of <code>bash</code> and <code>cmd_exe</code>. It will be subject to the following environment variable substitutions:<dl><dt><code>SRCS</code><dt><dd>A string expansion of the <code>srcs</code> argument delimited by the <code>environment_expansion_separator</code> argument where each element of <code>srcs</code> will be translated into an absolute path.</dd><dt><code>SRCDIR</code><dt><dd>The absolute path to a directory to which sources are copied to prior to running the command.</dd><dt><code>OUT</code></dt><dd><p>The output file or directory for the <code>genrule()</code>. This variable will have whatever value is specified by the <code>out</code> argument. The value should be a valid filepath. The semantics of the shell command determine whether this filepath is treated as a file or a directory. If the filepath is a directory, then the shell command needs to create it.</p><p>The file or directory specified by this variable must always be written by this command. If not, the execution of this rule will be considered a failure, halting the build process.</p></dd><dt><code>TMP</code></dt><dd>A temporary directory which can be used for intermediate results and will not be bundled into the output.</dd></dl><br>It is also possible to expand references to other rules within the <code>cmd</code>, using builtin <a href="/function/string_parameter_macros.html">string parameter macros</a>. Note that all build rules expanded in the command will be automatically considered to be dependencies of the <code>genrule()</code>.<dl><dt><code>$(classpath /&#x2F;path/to:target)</code></dt><dd>Expands a build rule for something that has a java classpath to the transitive classpath of that rule. If the rule does not have (or contribute to) a classpath, an exception will be thrown and the build will break.</dd><dt><code>$(exe /&#x2F;path/to:target)</code></dt><dd>Expands a build rule that results in an executable to the commands necessary to execute that command. For example, a <code>java_binary()</code> may expand to a call to <code>java -jar path/to/target.jar</code>. Files that are executable (perhaps generated by a <code>genrule()</code>) will also be expanded. If the build rule does not generate an executable output an exception will be thrown and the build will break.</dd><dt><code>$(location /&#x2F;path/to:target)</code></dt><dd>Expands to the location of the output of the build rule. This means that you can refer to these without needing to be aware of how Buck is storing data on the disk mid-build.</dd><dt><code>$(maven_coords /&#x2F;path/to:target)</code></dt><dd>Expands to the Maven coordinates for the build rule. This allows you to access the Maven coordinates for Maven-aware build rules. The format of the expansion is: <code>&lt;groupId&gt;:&lt;artifactId&gt;[:&lt;extension&gt;[:&lt;classifier&gt;]]:&lt;version&gt;</code></dd></dl></p></li><li id="bash" class="arg"><h3><code class="argName">bash</code> <span class="argDefault">(defaults to <code>None</code>)</span> <a class="inline-link" href="#bash">#</a></h3><p>A platform-specific version of the shell command parameter <code>cmd</code>. It runs on Linux and UNIX systems&mdash;including OSX&mdash;on which <code>bash</code> is installed. It has a higher priority than  <code>cmd</code>. The <code>bash</code> argument is run with <code>/bin/bash -c</code>. It has access to the same set of macros and variables as the <code>cmd</code> argument.</p></li><li id="cmd_exe" class="arg"><h3><code class="argName">cmd_exe</code> <span class="argDefault">(defaults to <code>None</code>)</span> <a class="inline-link" href="#cmd_exe">#</a></h3><p>A platform-specific version of the shell command parameter <code>cmd</code>. It runs on Windows and has a higher priority than <code>cmd</code>. The <code>cmd_exe</code> argument is run with <code>cmd.exe /c</code>. It has access to the same set of macros and variables as the <code>cmd</code> argument.</p></li><li id="type" class="arg"><h3><code class="argName">type</code> <span class="argDefault">(defaults to <code>None</code>)</span> <a class="inline-link" href="#type">#</a></h3><p><p>Specifies the <em>type</em> of this genrule. This is used for logging and is particularly useful for grouping genrules that share an underlying logical "type".</p><p>For example, if you have the following <code>cxx_genrule</code> defined in the root directory of your Buck project</p><p><pre>
cxx_genrule(
  name = 'cxx_gen',
  type = 'epilog',
  cmd  = 'touch finish.txt; cp finish.txt $OUT',
  out  = 'finish.txt'
)
</pre></p><p>then the following <code>buck query</code> command</p><p><pre>
buck query "attrfilter( type, 'epilog', '//...' )"
</pre></p><p>returns</p><p><pre>
//:cxx_gen
</pre></p></p></li><li id="out" class="arg"><h3><code class="argName">out</code> <span class="argDefault">(required)</span> <a class="inline-link" href="#out">#</a></h3><p>The name of the output file or directory. The complete path to this argument is provided to the shell command through the <code>OUT</code> environment variable.</p></li><li id="environment_expansion_separator" class="arg"><h3><code class="argName">environment_expansion_separator</code> <span class="argDefault">(defaults to <code>&quot; &quot;</code>)</span> <a class="inline-link" href="#environment_expansion_separator">#</a></h3><p>The delimiter between paths in environment variables, such as SRCS, that can contain multiple paths. It can be useful to specify this parameter if the paths could contain spaces.</p></li><li id="no_remote" class="arg"><h3><code class="argName">no_remote</code> <span class="argDefault">(defaults to <code>False</code>)</span> <a class="inline-link" href="#no_remote">#</a></h3><p>Whether this rule (and all rules that depend on it) can be executed remotely. This does not change whether this rule (or any rule that depends on it) can be cached (locally or remotely). This feature may be removed in the future.</p></li><li id="enable_sandbox" class="arg"><h3><code class="argName">enable_sandbox</code> <span class="argDefault">(defaults to <code>False</code>)</span> <a class="inline-link" href="#enable_sandbox">#</a></h3><p>Whether this target should be executed in a sandbox or not.</p></li><li id="executable" class="arg"><h3><code class="argName">executable</code> <span class="argDefault">(defaults to <code>False</code>)</span> <a class="inline-link" href="#executable">#</a></h3><p>Whether the output of the genrule is itself executable. Marking an output as executable makes <code>buck run</code> and <code>$(exe ...)</code> macro expansion work with this target.</p></li><li id="tests" class="arg"><h3><code class="argName">tests</code> <span class="argDefault">(defaults to <code>[]</code>)</span> <a class="inline-link" href="#tests">#</a></h3><p>List of <a href="/concept/build_target.html">build targets</a> that identify tests that exercise this target.</p></li><li id="visibility" class="arg"><h3><code class="argName">visibility</code> <span class="argDefault">(defaults to <code>[]</code>)</span> <a class="inline-link" href="#visibility">#</a></h3><p>List of <a href="/concept/build_target_pattern.html">build target patterns</a> that identify the build rules that can include this rule as a dependency, for example, by listing it in their <code>deps</code> or <code>exported_deps</code> attributes. For more information, see <a href="/concept/Visibility.html">Visibility</a>.</p></li><li id="licenses" class="arg"><h3><code class="argName">licenses</code> <span class="argDefault">(defaults to <code>[]</code>)</span> <a class="inline-link" href="#licenses">#</a></h3><p>Set of license files for this library.  To get the list of license files for a given <a href="/concept/build_rule.html">build rule</a> and all of its dependencies, you can use <a href="/command/query.html"><code>buck query</code></a>.</p></li><li id="labels" class="arg"><h3><code class="argName">labels</code> <span class="argDefault">(defaults to <code>[]</code>)</span> <a class="inline-link" href="#labels">#</a></h3><p>Set of arbitrary strings which allow you to annotate a <a href="/concept/build_rule.html">build rule</a> with tags that can be searched for over an entire dependency tree using <a href="/command/query.html#attrfilter"><code>buck query attrfilter</code></a>.</p></li></ul><h2>Examples</h2>This genrule() uses a Python script to derive a new <code>AndroidManifest.xml</code> from an <code>AndroidManifest.xml</code> in the source tree. Note you don't need to prepend execution commands with <code>python</code>: Buck knows how to execute different kinds of binaries using <code>$(exe)</code> command.<pre class="prettyprint lang-py">
genrule(
  name = 'generate_manifest',
  srcs = [
    'AndroidManifest.xml',
  ],
  bash = '$(exe //python/android:basic_to_full) ' \
      '$SRCDIR/AndroidManifest.xml > $OUT',
  cmd_exe = '$(exe //python/android:basic_to_full) ' \
      '%SRCDIR%\\AndroidManifest.xml > %OUT%',
  out = 'AndroidManifest.xml',
)
</pre></div></article><nav><h3>The Basics</h3><ul><li class=""><a href="/setup/getting_started.html">Getting Started</a></li><li class=""><a href="/about/overview.html">Key Topics</a></li><li class=""><a href="/learning/tutorial.html">Tutorial</a></li><li class=""><a href="/setup/intellij_plugin_install.html">Installing the IntelliJ Plugin</a></li><li class=""><a href="/article/exopackage.html">Exopackage</a></li><li class=""><a href="/article/query_cheat_sheet.html">Buck Query Cheat Sheet</a></li></ul><h3>About</h3><ul><li class=""><a href="/concept/what_makes_buck_so_fast.html">What Makes Buck so Fast?</a></li><li class=""><a href="/about/showcase.html">Showcase</a></li><li class=""><a href="/concept/troubleshooting.html">Troubleshooting</a></li><li class=""><a href="/about/performance_tuning.html">Performance Tuning</a></li><li class=""><a href="/concept/faq.html">FAQ</a></li><li class=""><a href="/presentations/index.html">Learn More (Buck Presentations)</a></li></ul><h3>Concepts</h3><ul><li class=""><a href="/concept/build_rule.html">Build Rule</a></li><li class=""><a href="/concept/build_file.html">Build File</a></li><li class=""><a href="/concept/build_target.html">Build Target</a></li><li class=""><a href="/concept/build_target_pattern.html">Build Target Pattern</a></li><li class=""><a href="/concept/buckjavaargs.html">.buckjavaargs</a></li><li class=""><a href="/concept/buckconfig.html">.buckconfig</a></li><li class=""><a href="/concept/visibility.html">Visibility</a></li><li class=""><a href="/concept/http_cache_api.html">HTTP Cache API</a></li><li class=""><a href="/concept/rule_keys.html">Rule Keys</a></li><li class=""><a href="/concept/java_abis.html">Java ABIs</a></li><li class=""><a href="/concept/skylark.html">Skylark</a></li></ul><h3>Build Rules</h3><ul><li><strong>Core</strong></li><li class=""><a href="/rule/command_alias.html">command_alias()</a></li><li class=""><a href="/rule/export_file.html">export_file()</a></li><li class=""><a href="/rule/filegroup.html">filegroup()</a></li><li class="navActiveItem"><a href="/rule/genrule.html">genrule()</a></li><li class=""><a href="/rule/http_archive.html">http_archive()</a></li><li class=""><a href="/rule/http_file.html">http_file()</a></li><li class=""><a href="/rule/remote_file.html">remote_file()</a></li><li class=""><a href="/rule/worker_tool.html">worker_tool()</a></li><li class=""><a href="/rule/zip_file.html">zip_file()</a></li><li><strong>Android</strong></li><li class=""><a href="/rule/android_aar.html">android_aar()</a></li><li class=""><a href="/rule/android_binary.html">android_binary()</a></li><li class=""><a href="/rule/android_build_config.html">android_build_config()</a></li><li class=""><a href="/rule/android_instrumentation_apk.html">android_instrumentation_apk()</a></li><li class=""><a href="/rule/android_instrumentation_test.html">android_instrumentation_test()</a></li><li class=""><a href="/rule/android_library.html">android_library()</a></li><li class=""><a href="/rule/android_manifest.html">android_manifest()</a></li><li class=""><a href="/rule/android_prebuilt_aar.html">android_prebuilt_aar()</a></li><li class=""><a href="/rule/android_resource.html">android_resource()</a></li><li class=""><a href="/rule/apk_genrule.html">apk_genrule()</a></li><li class=""><a href="/rule/gen_aidl.html">gen_aidl()</a></li><li class=""><a href="/rule/keystore.html">keystore()</a></li><li class=""><a href="/rule/ndk_library.html">ndk_library()</a></li><li class=""><a href="/rule/prebuilt_jar.html">prebuilt_jar()</a></li><li class=""><a href="/rule/prebuilt_native_library.html">prebuilt_native_library()</a></li><li class=""><a href="/rule/robolectric_test.html">robolectric_test()</a></li><li><strong>CXX</strong></li><li class=""><a href="/rule/cxx_binary.html">cxx_binary()</a></li><li class=""><a href="/rule/cxx_library.html">cxx_library()</a></li><li class=""><a href="/rule/cxx_genrule.html">cxx_genrule()</a></li><li class=""><a href="/rule/cxx_precompiled_header.html">cxx_precompiled_header()</a></li><li class=""><a href="/rule/cxx_test.html">cxx_test()</a></li><li class=""><a href="/rule/prebuilt_cxx_library.html">prebuilt_cxx_library()</a></li><li class=""><a href="/rule/prebuilt_cxx_library_group.html">prebuilt_cxx_library_group()</a></li><li><strong>D</strong></li><li class=""><a href="/rule/d_binary.html">d_binary()</a></li><li class=""><a href="/rule/d_library.html">d_library()</a></li><li class=""><a href="/rule/d_test.html">d_test()</a></li><li><strong>Go</strong></li><li class=""><a href="/rule/go_binary.html">go_binary()</a></li><li class=""><a href="/rule/go_library.html">go_library()</a></li><li class=""><a href="/rule/go_test.html">go_test()</a></li><li class=""><a href="/rule/cgo_library.html">cgo_library()</a></li><li><strong>Groovy</strong></li><li class=""><a href="/rule/groovy_library.html">groovy_library()</a></li><li><strong>Halide</strong></li><li class=""><a href="/rule/halide_library.html">halide_library()</a></li><li><strong>Haskell</strong></li><li class=""><a href="/rule/haskell_binary.html">haskell_binary()</a></li><li class=""><a href="/rule/haskell_library.html">haskell_library()</a></li><li class=""><a href="/rule/prebuilt_haskell_library.html">prebuilt_haskell_library()</a></li><li><strong>iOS</strong></li><li class=""><a href="/rule/apple_asset_catalog.html">apple_asset_catalog()</a></li><li class=""><a href="/rule/apple_binary.html">apple_binary()</a></li><li class=""><a href="/rule/apple_bundle.html">apple_bundle()</a></li><li class=""><a href="/rule/apple_library.html">apple_library()</a></li><li class=""><a href="/rule/apple_package.html">apple_package()</a></li><li class=""><a href="/rule/apple_resource.html">apple_resource()</a></li><li class=""><a href="/rule/apple_test.html">apple_test()</a></li><li class=""><a href="/rule/core_data_model.html">core_data_model()</a></li><li class=""><a href="/rule/prebuilt_apple_framework.html">prebuilt_apple_framework()</a></li><li><strong>Java</strong></li><li class=""><a href="/rule/java_binary.html">java_binary()</a></li><li class=""><a href="/rule/java_library.html">java_library()</a></li><li class=""><a href="/rule/java_test.html">java_test()</a></li><li class=""><a href="/rule/prebuilt_jar.html">prebuilt_jar()</a></li><li class=""><a href="/rule/prebuilt_native_library.html">prebuilt_native_library()</a></li><li><strong>Kotlin</strong></li><li class=""><a href="/rule/kotlin_library.html">kotlin_library()</a></li><li class=""><a href="/rule/kotlin_test.html">kotlin_test()</a></li><li><strong>Lua</strong></li><li class=""><a href="/rule/cxx_lua_extension.html">cxx_lua_extension()</a></li><li class=""><a href="/rule/lua_binary.html">lua_binary()</a></li><li class=""><a href="/rule/lua_library.html">lua_library()</a></li><li><strong>OCaml</strong></li><li class=""><a href="/rule/ocaml_binary.html">ocaml_binary()</a></li><li class=""><a href="/rule/ocaml_library.html">ocaml_library()</a></li><li><strong>Python</strong></li><li class=""><a href="/rule/prebuilt_python_library.html">prebuilt_python_library()</a></li><li class=""><a href="/rule/python_binary.html">python_binary()</a></li><li class=""><a href="/rule/python_library.html">python_library()</a></li><li class=""><a href="/rule/python_test.html">python_test()</a></li><li><strong>Rust</strong></li><li class=""><a href="/rule/rust_binary.html">rust_binary()</a></li><li class=""><a href="/rule/rust_library.html">rust_library()</a></li><li class=""><a href="/rule/rust_test.html">rust_test()</a></li><li class=""><a href="/rule/prebuilt_rust_library.html">prebuilt_rust_library()</a></li><li><strong>.NET</strong></li><li class=""><a href="/rule/csharp_library.html">csharp_library()</a></li><li class=""><a href="/rule/prebuilt_dotnet_library.html">prebuilt_dotnet_library()</a></li></ul><h3>Functions</h3><ul><li><strong>Python DSL</strong></li><li class=""><a href="/function/add_build_file_dep.html">add_build_file_dep()</a></li><li class=""><a href="/function/allow_unsafe_import.html">allow_unsafe_import()</a></li><li class=""><a href="/function/flatten_dicts.html">flatten_dicts()</a></li><li class=""><a href="/function/glob.html">glob()</a></li><li class=""><a href="/function/get_base_path.html">get_base_path()</a></li><li class=""><a href="/function/get_cell_name.html">get_cell_name()</a></li><li class=""><a href="/function/host_info.html">host_info()</a></li><li class=""><a href="/function/include_defs.html">include_defs()</a></li><li class=""><a href="/function/load.html">load()</a></li><li class=""><a href="/function/read_config.html">read_config()</a></li><li class=""><a href="/function/subdir_glob.html">subdir_glob()</a></li><li class=""><a href="/function/string_parameter_macros.html">String Parameter Macros</a></li></ul><ul><li><strong>Skylark</strong></li><li class=""><a href="/skylark/generated/glob.html">glob()</a></li><li class=""><a href="/skylark/generated/host_info.html">host_info()</a></li><li class=""><a href="/skylark/generated/read_config.html">read_config()</a></li><li class=""><a href="/skylark/generated/struct.html">struct()</a></li><li class=""><a href="/skylark/generated/package_name.html">package_name()</a></li><li class=""><a href="/skylark/generated/repository_name.html">repository_name()</a></li></ul><h3>Commands</h3><ul><li class=""><a href="/command/common_parameters.html">Common Parameters</a></li><li class=""><a href="/command/audit.html">buck audit</a></li><li class=""><a href="/command/build.html">buck build</a></li><li class=""><a href="/command/clean.html">buck clean</a></li><li class=""><a href="/command/doctor.html">buck doctor</a></li><li class=""><a href="/command/fetch.html">buck fetch</a></li><li class=""><a href="/command/fix.html">buck fix</a></li><li class=""><a href="/command/install.html">buck install</a></li><li class=""><a href="/command/project.html">buck project</a></li><li class=""><a href="/command/publish.html">buck publish</a></li><li class=""><a href="/command/query.html">buck query</a></li><li class=""><a href="/command/run.html">buck run</a></li><li class=""><a href="/command/root.html">buck root</a></li><li class=""><a href="/command/server.html">buck server</a></li><li class=""><a href="/command/suggest.html">buck suggest</a></li><li class=""><a href="/command/targets.html">buck targets</a></li><li class=""><a href="/command/test.html">buck test</a></li><li class=""><a href="/command/uninstall.html">buck uninstall</a></li><li class=""><a href="/command/buckd.html">buckd</a></li><li class=""><a href="/command/exit_codes.html">Exit Codes</a></li></ul><h3>Extending Buck</h3><ul><li class=""><a href="/extending/macros.html">Custom Macros</a></li><li class=""><a href="/extending/rules.html">Custom Rules</a></li><li class=""><a href="/extending/e2e_tests.html">Building E2E Tests for Buck</a></li></ul></nav></div></section><footer><div class='width'>&copy; Copyright Facebook, 2013 - 2018</div></footer><!-- Algolia Search Code --><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
docsearch({
  apiKey: 'c25b7174e8f6161ce5fdd44bb0b95081',
  indexName: 'buckbuild',
  inputSelector: '#algolia-doc-search',
  debug: false // Set debug to true if you want to inspect the dropdown
});
</script><!-- End Algolia Search Code --><script src="/google-code-prettify/prettify.js"></script><script>prettyPrint()</script></body></html>
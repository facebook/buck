java_library(
  name = 'types',
  srcs = [
    'Cell.java',
    'KnownBuildRuleTypes.java',
    'KnownBuildRuleTypesFactory.java',
  ],
  tests = [
    '//test/com/facebook/buck/rules:rules',
  ],
  deps = [
    ':build_rule',
    ':rules',
    '//src/com/facebook/buck/android:rules',
    '//src/com/facebook/buck/android:steps',
    '//src/com/facebook/buck/android:utils',
    '//src/com/facebook/buck/apple:rules',
    '//src/com/facebook/buck/cli:config',
    '//src/com/facebook/buck/cxx:platform',
    '//src/com/facebook/buck/cxx:rules',
    '//src/com/facebook/buck/d:d',
    '//src/com/facebook/buck/dotnet:dotnet',
    '//src/com/facebook/buck/event:event',
    '//src/com/facebook/buck/file:downloader',
    '//src/com/facebook/buck/file:file',
    '//src/com/facebook/buck/go:go',
    '//src/com/facebook/buck/gwt:gwt',
    '//src/com/facebook/buck/halide:rules',
    '//src/com/facebook/buck/io:io',
    '//src/com/facebook/buck/io:watchman',
    '//src/com/facebook/buck/js:js',
    '//src/com/facebook/buck/json:json',
    '//src/com/facebook/buck/jvm/groovy:rules',
    '//src/com/facebook/buck/jvm/java:config',
    '//src/com/facebook/buck/jvm/java:rules',
    '//src/com/facebook/buck/jvm/java:support',
    '//src/com/facebook/buck/log:api',
    '//src/com/facebook/buck/log:log',
    '//src/com/facebook/buck/model:model',
    '//src/com/facebook/buck/ocaml:rules',
    '//src/com/facebook/buck/parser:config',
    '//src/com/facebook/buck/parser:rule_pattern',
    '//src/com/facebook/buck/python:config',
    '//src/com/facebook/buck/python:rules',
    '//src/com/facebook/buck/python:support',
    '//src/com/facebook/buck/rules/macros:macros',
    '//src/com/facebook/buck/rust:rust',
    '//src/com/facebook/buck/shell:rules',
    '//src/com/facebook/buck/thrift:rules',
    '//src/com/facebook/buck/timing:timing',
    '//src/com/facebook/buck/util:constants',
    '//src/com/facebook/buck/util:exceptions',
    '//src/com/facebook/buck/util:io',
    '//src/com/facebook/buck/util:util',
    '//src/com/facebook/buck/util/environment:platform',
    '//src/com/facebook/buck/zip:rules',
    '//third-party/java/aosp:aosp',
    '//third-party/java/guava:guava',
    '//third-party/java/jsr:jsr305',
  ],
  visibility = [
    '//src/com/facebook/buck/cli:cli',
    '//src/com/facebook/buck/parser:parser',
    '//test/...',
  ],
)

java_library(
  name = 'rule_key',
  srcs = [
    'RuleKey.java',
  ],
  deps = [
    '//third-party/java/guava:guava',
    '//third-party/java/jsr:jsr305',
  ],
  visibility = [
    'PUBLIC',
  ],
)

# Ideally, BuildRule.java would require only a handful of other source files
# in order to compile it. Because BuildContext is referenced in the BuildRule
# interface, its dependencies are much broader than desired.
java_immutables_library(
  name = 'build_rule',
  srcs = [
    'AbstractBuildRule.java',
    'AbstractBuildRuleType.java',
    'AbstractExopackageInfo.java',
    'AbstractExternalTestRunnerTestSpec.java',
    'AbstractLabel.java',
    'AbstractSha1HashCode.java',
    'AbstractSourcePath.java',
    'AbstractSourceWithFlags.java',
    'ActionGraph.java',
    'ActionGraphEvent.java',
    'AddToRuleKey.java',
    'BinaryBuildRule.java',
    'BuckPyFunction.java',
    'BuildableContext.java',
    'BuildableProperties.java',
    'BuildContext.java',
    'BuildEngine.java',
    'BuildInfo.java',
    'BuildInfoRecorder.java',
    'BuildResult.java',
    'BuildRule.java',
    'BuildRuleDependencyVisitors.java',
    'BuildRuleFactoryParams.java',
    'BuildRuleResolver.java',
    'BuildRuleParams.java',
    'BuildRules.java',
    'BuildRuleStatus.java',
    'BuildRuleSuccessType.java',
    'BuildTargetSourcePath.java',
    'CommandTool.java',
    'ConstructorArgMarshaller.java',
    'ConstructorArgMarshalException.java',
    'DefaultOnDiskBuildInfo.java',
    'Description.java',
    'ExportDependencies.java',
    'HashedFileTool.java',
    'HasPostBuildSteps.java',
    'HasRuntimeDeps.java',
    'Hint.java',
    'ImplicitDepsInferringDescription.java',
    'ImplicitInputsInferringDescription.java',
    'MetadataProvidingDescription.java',
    'NonHashableSourcePathContainer.java',
    'OnDiskBuildInfo.java',
    'ParamInfo.java',
    'ParamInfoException.java',
    'PathSourcePath.java',
    'RecordFileSha1Step.java',
    'ResourceSourcePath.java',
    'RuleKeyAppendable.java',
    'RuleKeyBuilder.java',
    'RuleKeyBuilderFactory.java',
    'SourcePath.java',
    'SourcePathResolver.java',
    'SourcePaths.java',
    'SourceRoot.java',
    'TargetGraph.java',
    'TargetGraphHashing.java',
    'TargetGraphToActionGraph.java',
    'TargetGraphTransformer.java',
    'TargetName.java',
    'TargetNode.java',
    'TargetNodeToBuildRuleTransformer.java',
    'TargetNodes.java',
    'Tool.java',
  ],
  tests = [
    '//test/com/facebook/buck/rules/coercer:coercer',
    '//test/com/facebook/buck/rules:rules',
  ],
  deps = [
    '//src/com/facebook/buck/android:exceptions',
    '//src/com/facebook/buck/android:utils',
    '//src/com/facebook/buck/artifact_cache:artifact_cache',
    '//src/com/facebook/buck/event:event',
    '//src/com/facebook/buck/graph:graph',
    '//src/com/facebook/buck/io:io',
    '//src/com/facebook/buck/jvm/core:packagefinder',
    '//src/com/facebook/buck/log:api',
    '//src/com/facebook/buck/model:model',
    '//src/com/facebook/buck/parser:rule_pattern',
    '//src/com/facebook/buck/rules/coercer:types',
    '//src/com/facebook/buck/step:step',
    '//src/com/facebook/buck/timing:timing',
    '//src/com/facebook/buck/util:constants',
    '//src/com/facebook/buck/util:exceptions',
    '//src/com/facebook/buck/util:util',
    '//src/com/facebook/buck/util/cache:cache',
    '//src/com/facebook/buck/util/hash:hash',
    '//third-party/java/gson:gson',
    '//third-party/java/jackson:jackson',
  ],
  exported_deps = [
    ':rule_key',
  ],
  visibility = [
    'PUBLIC',
  ],
)

java_library(
  name = 'build_event',
  srcs = [
    'BuildEvent.java',
  ],
  deps = [
    '//src/com/facebook/buck/event:event',
    '//src/com/facebook/buck/model:model',
    '//third-party/java/guava:guava',
  ],
)

java_immutables_library(
  name = 'rules',
  srcs = [
    'AssociatedTargetNodePredicate.java',
    'BuildOutputInitializer.java',
    'BuildRuleEvent.java',
    'CachingBuildEngine.java',
    'DefaultBuildableContext.java',
    'ExternalTestRunnerRule.java',
    'IndividualTestEvent.java',
    'InitializableFromDisk.java',
    'InstallableApk.java',
    'Manifest.java',
    'NoopBuildRule.java',
    'ProjectConfig.java',
    'ProjectConfigDescription.java',
    'SymlinkTree.java',
    'TargetGraphAndTargets.java',
    'TestRule.java',
    'TestRunEvent.java',
    'TestSummaryEvent.java',
  ],
  tests = [
    '//test/com/facebook/buck/rules:rules',
  ],
  deps = [
    ':build_event',
    ':build_rule',
    '//src/com/facebook/buck/android:exceptions',
    '//src/com/facebook/buck/artifact_cache:artifact_cache',
    '//src/com/facebook/buck/cli:events',
    '//src/com/facebook/buck/event:event',
    '//src/com/facebook/buck/graph:graph',
    '//src/com/facebook/buck/io:io',
    '//src/com/facebook/buck/log:api',
    '//src/com/facebook/buck/model:model',
    '//src/com/facebook/buck/parser:rule_pattern',
    '//src/com/facebook/buck/rules/keys:keys',
    '//src/com/facebook/buck/shell:steps',
    '//src/com/facebook/buck/step:step',
    '//src/com/facebook/buck/step/fs:fs',
    '//src/com/facebook/buck/test:test',
    '//src/com/facebook/buck/test/selectors:selectors',
    '//src/com/facebook/buck/timing:timing',
    '//src/com/facebook/buck/util:constants',
    '//src/com/facebook/buck/util:exceptions',
    '//src/com/facebook/buck/util:util',
    '//src/com/facebook/buck/util/cache:cache',
    '//src/com/facebook/buck/util/collect:collect',
    '//src/com/facebook/buck/util/concurrent:concurrent',
    '//src/com/facebook/buck/util/environment:environment',
    '//src/com/facebook/buck/util/hash:hash',
    '//src/com/facebook/buck/util/network:network',
    '//src/com/facebook/buck/zip:steps',
    '//src/com/facebook/buck/zip:unzip',
    '//third-party/java/commons-compress:commons-compress',
    '//third-party/java/guava:guava',
    '//third-party/java/infer-annotations:infer-annotations',
    '//third-party/java/jackson:jackson-annotations',
    '//third-party/java/jackson:jackson-core',
    '//third-party/java/jackson:jackson-databind',
    '//third-party/java/jsr:jsr305',
    '//third-party/java/okhttp:okhttp',
    '//third-party/java/okio:okio',
  ],
  exported_deps = [
    ':build_event',
  ],
  visibility = ['PUBLIC'],
)
